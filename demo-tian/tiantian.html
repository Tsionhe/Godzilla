<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>还剩8天</title>
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <link rel="stylesheet" href="css/animate.css">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="main">
    <div class="audio" id="audioCtrl">
      <div class="line"></div>
      <div class="line delay-1"></div>
      <div class="line delay-3"></div>
      <div class="line delay-1"></div>
    </div>
    <div class="step step1">
      <div class="a animated rollIn delay-1s">今天</div>
      <div class="b animated lightSpeedIn delay-2s">是什么日子呢？</div>
    </div>
    <div class="step step2">
      <div class="a animated bounceInDown delay-1s">2016-8-6</div>
      <div class="b animated bounceInDown delay-2s">今天是31届奥运会</div>
    </div>
    <div class="step step3">
      <div class="a animated lightSpeedIn delay-1s">其实</div>
      <div class="b animated lightSpeedIn delay-2s">今天也是一个特殊的日子</div>
      <div class="c animated lightSpeedIn delay-3s">你知道是什么日子么？</div>
    </div>
    <div class="step step4">
      <div class="a animated flipInY delay-1s">应该你也知道</div>
      <div class="b animated flipInY delay-2s">离你回家的日子还剩多少天？</div>
      <div class="c animated flipInY delay-3s">让我们数一数</div>
    </div>
    <div class="step step5">
      <div class="a animated flipInY delay-1s">?</div>
    </div>
    <div class="step step6">
      <div class="a animated bounceIn delay-2s">我来数</div>
      <div class="animated bounceInDown number">1</div>
      <div class="animated bounceInDown number">2</div>
      <div class="animated bounceInDown number">3</div>
      <div class="animated bounceInDown number">4</div>
      <div class="animated bounceInDown number">5</div>
      <div class="animated bounceInDown number">6</div>
      <div class="animated bounceInDown number">7</div>
      <div class="animated bounceInDown number">8</div>
    </div>
    <div class="step step7">
      <div class="a animated fadeIn delay-1s">哈哈哈，还有8天就回家了</div>
      <div class="b animated fadeIn delay-2s">祝你回去玩的快快乐乐！</div>
    </div>
    <div class="button" id="button">Click me</div>
    <canvas id="canvas" style="width: 100%;height: 100%;position: absolute"></canvas>
    <audio id="audio" src="img/anni.mp3" loop="loop"></audio>
    <div class="hov_loading">
      <div class="pic animated bounce infinite"><img src="img/aoyun.png" alt=""></div>
    </div>
  </div>
  <script src="js/jquery-1.7.1.min.js"></script>
  <script>
    $(function () {
      var audio= document.getElementById("audio");
      var audioCtrl = $("#audioCtrl");
      var playAudio = true;
      var step = 1;
      var isclick = true;
      function canPlayAudioMP3(callback){
        try {
          var audio = new Audio();
          //Shortcut which doesn't work in Chrome (always returns ""); pass through
          // if "maybe" to do asynchronous check by loading MP3 data: URI
          if(audio.canPlayType('audio/mp3') == "probably")
            callback(true);

          //If this event fires, then MP3s can be played
          audio.addEventListener('canplaythrough', function(e){
            callback(true);
          }, false);

          //If this is fired, then client can't play MP3s
          audio.addEventListener('error', function(e){
            callback(false, this.error)
          }, false);

          //Smallest base64-encoded MP3 I could come up with (<0.000001 seconds long)
          audio.src = "img/anni.mp3";
          audio.load();
        }
        catch(e){
          callback(false, e);
        }
      }
      canPlayAudioMP3(function () {
        audio.play();
        $(".hov_loading").hide();
        $(".step1").show();
        $(".main").addClass('active');
      });
      audioCtrl.click(function () {
        if(audio.paused) {
          audio.play();
        } else {
          audio.pause();
        }
      });
      $("#button").click(function () {
        if(step == 1 && isclick) {
          isclick = false;
          console.log(isclick)
          $(".step1 .a").removeClass('rollIn delay-1s').addClass('rotateOutUpLeft');
          $(".step1 .b").removeClass('lightSpeedIn delay-2s').addClass('lightSpeedOut');
          $(".step2").show();
          step = 2;
          setTimeout(function () {
            isclick = true;
            console.log(isclick)
          }, 2000)
        } else if(step == 2 && isclick) {
          isclick = false;
          $(".step2 .a").removeClass('bounceInDown delay-1s').addClass('bounceOutUp');
          $(".step2 .b").removeClass('bounceInDown delay-2s').addClass('bounceOutUp');
          step = 3;
          $(".step3").show();
          setTimeout(function () {
            isclick = true;
          }, 2000)
        } else if(step == 3 && isclick) {
          isclick = false;
          $(".step3 .a").removeClass('bounceInDown delay-1s').addClass('lightSpeedOut');
          $(".step3 .b").removeClass('bounceInDown delay-2s').addClass('lightSpeedOut delay-1');
          $(".step3 .c").removeClass('bounceInDown delay-3s').addClass('lightSpeedOut delay-2');
          step = 4;
          $(".step4").show();
          setTimeout(function () {
            isclick = true;
          }, 2000)
        } else if(step == 4 && isclick) {
          isclick = false;
          $(".step4 .a").removeClass('lightSpeedIn delay-1s').addClass('lightSpeedOut');
          $(".step4 .b").removeClass('lightSpeedIn delay-2s').addClass('lightSpeedOut delay-1');
          $(".step4 .c").removeClass('lightSpeedIn delay-3s').addClass('lightSpeedOut delay-2');
          step = 5;
          $(".step5").show();
          setTimeout(function () {
            isclick = true;
          }, 2000)
        } else if(step == 5 && isclick) {
          isclick = false;
          $(".step5 .a").removeClass('flipInY delay-1s').addClass('hinge');
          var index = 0;
          var sets;
          $(".step6").show();
          var times = setTimeout(function () {
            console.log('a')
            sets = setInterval(function () {
              $(".number").hide().eq(index).show();
              index ++;
              if(index == 8) {
                step = 6;
                isclick = true;
                clearTimeout(sets);
              }
            }, 1000);
          }, 2500);
        } else if(step == 6 && isclick) {
          isclick = false;
          $(".step6 .a").removeClass('bounceIn delay-2s').addClass('fadeOut');
          $(".step6 .number").removeClass('bounceInDown').addClass('bounceOutDown');
          step = 7;
          $(".step7").show();
          $(this).html("再看一遍");
          setTimeout(function () {
            isclick = true;
          }, 2000)
        } else if(step == 7) {
          step = 1;
          $(this).html("Click me");
          $(".step1 .a").removeClass('rotateOutUpLeft').addClass('rollIn delay-1s');
          $(".step1 .b").removeClass('lightSpeedOut').addClass('lightSpeedIn delay-2s');
          $(".step2 .a").removeClass('bounceOutUp').addClass('bounceInDown delay-1s');
          $(".step2 .b").removeClass('bounceOutUp').addClass('bounceInDown delay-2s');
          $(".step3 .a").removeClass('lightSpeedOut').addClass('bounceInDown delay-1s');
          $(".step3 .b").removeClass('lightSpeedOut').addClass('bounceInDown delay-2s');
          $(".step3 .c").removeClass('lightSpeedOut').addClass('bounceInDown delay-3s');
          $(".step4 .a").removeClass('lightSpeedOut').addClass('lightSpeedIn delay-1s');
          $(".step4 .b").removeClass('lightSpeedOut delay-1').addClass('lightSpeedIn delay-2s');
          $(".step4 .c").removeClass('lightSpeedOut delay-2').addClass('lightSpeedIn delay-3s');
          $(".step5 .a").removeClass('hinge').addClass('flipInY delay-1s');
          $(".step6 .a").removeClass('fadeOut').addClass('bounceIn delay-2s');
          $(".step6 .number").removeClass('bounceOutDown').addClass('bounceInDown');
          $(".number").hide();
          $('.step').hide().eq(0).show();
        }
      })
    })
  </script>
</body>
</html>